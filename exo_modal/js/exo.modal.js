"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,_toPropertyKey(s.key),s)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!==_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var s=_superPropBase(e,t);if(s)return(s=Object.getOwnPropertyDescriptor(s,t)).get?s.get.call(arguments.length<3?e:i):s.value}).apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(i){var s=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(i);return _possibleConstructorReturn(this,s?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(f,p,a,v){var i=function(){_inherits(o,ExoData);var t=_createSuper(o);function o(){var e;return _classCallCheck(this,o),(e=t.apply(this,arguments)).label="Modal",e.doDebug=!1,e.defaults={preset:null,title:"",hideTitle:!1,subtitle:"",overlayColor:"rgba(0, 0, 0, 0.4)",icon:null,iconText:null,rtl:!1,inherit:!1,width:600,height:null,top:null,bottom:null,right:null,left:null,borderBottom:!0,padding:0,ajax:null,contentAjax:null,contentAjaxCache:!0,contentSelector:null,radius:3,zindex:999,iframe:!1,iframeHeight:400,iframeWidth:800,iframeResponsive:!1,iframeURL:null,imageUrl:null,focusInput:!0,group:"",nest:!1,loop:!1,arrowKeys:!0,navigateCaption:!0,navigateArrows:!0,navigateTitles:!1,history:!1,restoreDefaultContent:!1,destroyOnClose:!1,autoOpen:0,bodyOverflow:!0,fullscreen:!1,openFullscreen:!1,openTall:!1,closeOnEscape:!0,closeButton:!0,closeInBody:!1,smartActions:!0,appendTo:p.ExoModal.globalWrapper,appendToOverlay:p.ExoModal.globalWrapper,appendToNavigate:p.ExoModal.globalWrapper,class:"",appendToClosest:!1,overlay:!0,overlayClose:!0,timeout:!1,timeoutProgressbar:!1,pauseOnHover:!1,transitionIn:"comingIn",transitionOut:"comingOut",transitionInOverlay:"fadeIn",transitionOutOverlay:"fadeOut",transitionInPanel:"fadeInLeft",transitionOutPanel:"fadeOutLeft",onFullscreen:function(){},onResize:function(){},onOpening:function(){},onOpened:function(){},onClosing:function(){},onClosed:function(){},afterRender:function(){}},e.inheritExclude=["id","inherit","title","subtitle","icon","iconText","ajax","contentAjax","iframeUrl","_exoTime"],e.events={opening:new ExoEvent,opened:new ExoEvent,closing:new ExoEvent,closed:new ExoEvent},e.states={CLOSING:"closing",CLOSED:"closed",OPENING:"opening",OPENED:"opened",DESTROYED:"destroyed"},e.name="exo-modal",e.built=!1,e.width=0,e.widthOffset=0,e.timer=null,e.timerTimeout=null,e.timerInterval=null,e.progressBar=null,e.isPaused=!1,e.isFullscreen=!1,e.isCompressed=!1,e.isTall=!1,e.isSetHeight=!1,e.headerHeight=0,e.footerHeight=0,e.modalHeight=0,e.autoOpenProcessed=!1,e.panelOpen=!1,e.ajaxLoaded=!1,e.contentAjaxLoaded=!1,e.imageLoaded=!1,e}return _createClass(o,[{key:"build",value:function(i){var n=this;return new Promise(function(s,e){var t=[];i.class&&t.push(i.class),i.preset&&"object"===_typeof(a.exoModal.presets)&&a.exoModal.presets[i.preset]&&(i=jQuery.extend(!0,{},a.exoModal.presets[i.preset],i),a.exoModal.presets[i.preset].class)&&t.push(a.exoModal.presets[i.preset].class),(i=jQuery.extend(!0,{},p.ExoModal.getSettingsGroup("defaults"),i)).class=t.join(" "),_get(_getPrototypeOf(o.prototype),"build",n).call(n,i,!1).then(function(e){var t,i;null!==e?(n.debug("log","Build: Act","["+n.id+"]",e),(t=n.getTriggerElement().once("exo.modal")).length&&(n.debug("log","Build: Bind Trigger","["+n.id+"]"),n.bindTrigger()),(i=n.getElement().once("exo.modal")).length&&(n.debug("log","Build: Found Element","["+n.id+"]"),n.get("contentAjax"))&&(n.$contentAjaxPlaceholder=f('<div class="exo-modal-ajax-placeholder hidden" />').insertBefore(i)),t.length||i.length?(n.state=n.states.CLOSED,s(e)):s(null)):s(e)},e)})}},{key:"afterBuild",value:function(){var e,t=this;this.getElement().length&&(this.get("autoOpen")?p.Exo.isInitialized()?setTimeout(function(){t.open()}):p.Exo.event("ready").on("exo.modal."+this.getId(),function(){p.Exo.event("ready").off("exo.modal."+t.getId()),t.open()}):this.getElement().find(".exo-form-container-error").length&&(this.open(),(e=f(".messages.error")).length)&&!e.closest(".exo-modal").length&&this.$content.prepend(e))}},{key:"rebuildContent",value:function(){return this.built=!1,this}},{key:"refreshContent",value:function(){this.$content.find(".messages").length&&this.$wrap.scrollTop(0),this.bindClose(),this.createFooter()}},{key:"buildContent",value:function(){var i=this;if(this.$element&&this.$element.length&&!this.built){if(this.built=!0,this.debug("log","Build","["+this.getId()+"]",this.getData()),!0===this.get("inherit")){var e=p.ExoModal.getVisibleFocus();if(e){for(var t=this.$element[0].classList.length-1;0<=t;t--){var s=this.$element[0].classList[t];s.startsWith("exo-modal-theme-")&&this.$element[0].classList.remove(s)}for(var n=e.$element[0].classList.length-1;0<=n;n--){var o=e.$element[0].classList[n];o.startsWith("exo-modal-theme-")&&this.$element.addClass(o)}jQuery.each(e.getData(),function(e,t){-1===i.inheritExclude.indexOf(String(e))&&(i.data[e]=t)}),this.set("zindex",e.get("zindex")+1)}}this.$element.hasClass(this.name+"-hidden")&&this.$element.removeClass(this.name+"-hidden"),""!==this.get("class")&&this.$element.addClass(this.get("class"));var a=this.$element.closest(".exo-form");if(a.length)for(var l=a[0].classList.length-1;0<=l;l--){var r=a[0].classList[l];r.startsWith("exo-form")&&this.$element.addClass(r)}this.class=void 0!==this.$element.attr("class")?this.$element.attr("class"):"",this.content=this.$element.html(),this.$overlay=f('<div class="'+this.name+'-overlay" style="background-color:'+this.get("overlayColor")+'"></div>'),this.$navigate=f('<div class="'+this.name+'-navigate"><div class="'+this.name+'-navigate-caption">Use</div><button class="'+this.name+'-navigate-prev"></button><button class="'+this.name+'-navigate-next"></button></div>'),this.$element.attr("aria-hidden","true"),this.$element.attr("aria-labelledby",this.getId()),this.$element.attr("role","dialog"),this.$content=this.$element.find("."+this.name+"-content").first(),this.$sectionHeader=this.$element.find("."+this.name+"-section-header"),this.$sectionFooter=this.$element.find("."+this.name+"-section-footer");var h,d,c=f('form[class*="exo-form-theme-"]',this.$content);if(c.length){for(var m=null,g=this.$element[0].classList.length-1;0<=g;g--){var u=this.$element[0].classList[g];u.startsWith("exo-modal-theme-content-")&&(m=u.replace("exo-modal-theme-content-",""))}m&&(f('form[class*="exo-form-theme-"]',this.$content).removeClass(function(e,t){return(t.match(/(^|\s)exo-form-theme-\S+/g)||[]).join(" ")}),c.addClass("exo-form-theme-"+m))}this.$element.hasClass(this.name)||this.$element.addClass(this.name),""!==this.get("group")&&this.$element.attr("data-"+this.name+"-group",this.get("group")),!0===this.get("loop")&&this.$element.attr("data-"+this.name+"-loop","true"),!1!==this.get("appendTo")&&(!0===this.get("appendToClosest")?"form"===this.get("appendTo")?this.$element.prependTo(this.$element.closest(this.get("appendTo"))):this.$element.appendTo(this.$element.closest(this.get("appendTo"))):this.$element.appendTo(this.get("appendTo")),this.$element.closest(".exo-content").length)&&this.$element.css({top:v.offsets.top,bottom:v.offsets.bottom,left:v.offsets.left,right:v.offsets.right}),!0===this.get("iframe")&&(this.$content.html('<iframe class="'+this.name+'-iframe"></iframe>'),null!==this.get("iframeHeight"))&&(null!==this.get("iframeHeight")&&null!==this.get("iframeWidth")&&!0===this.get("iframeResponsive")?(c=this.getIframeResponsivePadding(),this.$content.find("."+this.name+"-iframe").css("width","100%").wrap('<div class="'+this.name+'-iframe-responsive" />'),this.$content.find("."+this.name+"-iframe-responsive").css("padding-bottom",c+"%")):this.$content.find("."+this.name+"-iframe").css("height",this.get("iframeHeight"))),this.$wrap=this.$element.find("."+this.name+"-wrap").first(),null!==this.get("zindex")&&this.setZindex(this.get("zindex")),""!==this.get("radius")&&this.$element.css("border-radius",this.get("radius")),""!==this.get("padding")&&0!==this.get("padding")&&this.$content.css("padding",this.get("padding")),!0===this.get("rtl")&&this.$element.addClass(this.name+"-rtl"),!1!==this.get("openFullscreen")&&(this.isFullscreen=!0,this.$element.addClass("isFullscreen")),this.get("height")&&(this.isSetHeight=!0,this.$element.addClass("isSetHeight")),!0===this.get("openTall")&&(this.isTall=!0,this.$element.addClass("isTall")),!1!==this.get("closeInBody")&&(h=f('<div class="exo-container-button '+this.get("closeInBody")+'"><a href="javascript:void(0)" class="'+this.name+"-button "+this.name+'-button-close" data-'+this.name+"-close></a></div>"),c=this.$element.find("."+this.name+"-container").first(),(c=(d=this.$element.find("."+this.name+"-section-header").first()).length?d:c).prepend(h),setTimeout(function(){i.widthOffset+=h.outerWidth()})),this.createHeader(),this.createFooter(),this.buildPanels(),this.recalcSize(),this.recalcVerticalPos(),this.recalcHorizontalPos(),this.callCallback("afterRender")}}},{key:"setZindex",value:function(e){e+=3*p.ExoModal.getVisible(!0).count(),this.set("zindex",e),this.$overlay.css("z-index",e-2),this.$navigate.css("z-index",e-1),this.$element.css("z-index",e)}},{key:"createHeader",value:function(){this.$element.find("."+this.name+"-header").remove();var e=!0===this.get("hideTitle")?"":this.get("title");this.$header=f('<div class="'+this.name+'-header"><h2 class="'+this.name+'-header-title">'+e+'</h2><p class="'+this.name+'-header-subtitle"><span>'+this.get("subtitle")+'</span></p><div class="'+this.name+'-header-buttons"></div></div>'),""===this.get("subtitle")&&this.$header.addClass(this.name+"-no-subtitle"),!0===this.get("fullscreen")&&this.$header.find("."+this.name+"-header-buttons").append('<a href="javascript:void(0)" class="'+this.name+"-button "+this.name+'-button-fullscreen" data-'+this.name+"-fullscreen></a>"),!0===this.get("closeButton")&&this.$header.find("."+this.name+"-header-buttons").append('<a href="javascript:void(0)" class="'+this.name+"-button "+this.name+'-button-close" data-'+this.name+"-close></a>"),!0===this.get("timeoutProgressbar")&&this.$header.prepend('<div class="'+this.name+'-progressbar"><div></div></div>'),this.$element.css("border-bottom-width",""),(""!==this.get("title")||!0===this.get("closeButton")||this.get("fullscreen")||this.get("timeoutProgressbar"))&&(!0===this.get("borderBottom")&&this.$element.css("border-bottom-width","3px"),null===this.get("icon")&&null===this.get("iconText")||(this.$header.prepend('<i class="'+this.name+'-header-icon"></i>'),null!==this.get("icon")&&this.$header.find("."+this.name+"-header-icon").addClass(this.get("icon")),null!==this.get("iconText")&&this.$header.find("."+this.name+"-header-icon").html(this.get("iconText"))),this.get("closeInBody")||this.$element.css("overflow","hidden").prepend(this.$header))}},{key:"createFooter",value:function(){var n,t,e,i,s,o,a=this,l=(this.$element.find("."+this.name+"-footer").remove(),this.$element.removeClass("has-footer"),this.$footer=f('<div class="'+this.name+'-footer"></div>'),!0===this.get("smartActions")&&(((l=this.$element.find(".form-actions")).length?l.last():this.$element.find(".exo-form-container-button--primary")).addClass("exo-modal-actions"),l.removeClass("exo-form-element"),f(".exo-modal-views-view .exo-form-container-form-actions").addClass("exo-modal-actions"),(l=this.$element.find(".exo-modal-actions:last input, .exo-modal-actions button, .exo-modal-actions a")).length)&&(this.$element.addClass("has-footer"),this.$element.css("border-bottom-width",0),this.set("borderBottom",!1),l.length)&&(n=function(e,t){var i=t.text().toLowerCase();t.is("a")?"cancel"===i||t.is("[data-"+a.name+"-close]")?a.close():window.location.href=t.attr("href"):t.trigger("mousedown").trigger("mouseup").trigger("click")},t=l.filter(".button--primary"),l.each(function(i,e){var s=f(e),e=t.length?s.hasClass("button--primary"):0===i;s.clone().attr("id",s.attr("id")?s.attr("id")+"-clone":"").attr("name",s.attr("name")?s.attr("name")+"-clone":"").attr("data-drupal-selector",s.attr("data-drupal-selector")?s.attr("data-drupal-selector")+"-clone":"").removeAttr("class").addClass("exo-modal-action"+(e?" primary":"")).on("click",function(e){e.preventDefault();var t=s.data("exo-modal-action-delay");t?void 0!==a.events[t]?a.event(t).on("exo.modal.footer."+i,function(e){a.event(t).off("exo.modal.footer."+i),n(0,s)}):t===parseInt(t)&&setTimeout(function(){n(0,s)},t):setTimeout(function(){n(0,s)})}).appendTo(a.$footer)}),l.closest(".exo-form-element-type-actions").addClass("exo-modal-hide"),l.closest(".exo-modal-actions").addClass("exo-modal-hide"),l.closest(".exo-form-container-exo-modal-actions").addClass("exo-modal-hide")),p.ExoModal.getGrouped(this.get("group")));1<l.count()&&!0===this.get("navigateTitles")&&(e=l.getPrev(this.getId(),this.get("loop")),l=l.getNext(this.getId(),this.get("loop")),i=f('<div class="exo-modal-navigate-titles"><a href="javascript:void(0)" class="exo-modal-navigate-title-prev" data-'+this.name+'-prev></a><a href="javascript:void(0)" class="exo-modal-navigate-title-next" data-'+this.name+"-next></a></div>"),s=f(".exo-modal-navigate-title-prev",i).hide(),o=f(".exo-modal-navigate-title-next",i).hide(),e&&s.text(e.get("title")||"Prev").fadeIn(),l&&o.text(l.get("title")||"Next").fadeIn(),i.appendTo(this.$footer)),this.$footer.children().length&&this.$element.append(this.$footer)}},{key:"buildPanels",value:function(){var s=this,e=this.$element.find(".exo-modal-panel-trigger").once("exo.modal");e.length&&(e.each(function(e,t){var i=f(t),t=i.data("exo-modal-panel");s.$element.find(".exo-modal-panel[data-exo-modal-panel="+t+"]").hide();i.find(".hide").hide(),i.on("click.exo.modal",function(e){e.preventDefault(),i.hasClass("active")?s.hidePanel(i):(s.hidePanels(),s.showPanel(i))})}),this.event("closed").on("exo.modal.panels",function(e){s.hidePanels(!1)}))}},{key:"showPanel",value:function(t,e){var i=this,s=(this.panelOpen=!0,t.data("exo-modal-panel")),n=this.$element.find(".exo-modal-panel[data-exo-modal-panel="+s+"]"),s=(t.data("exo-modal-width",this.get("width")),t.data("exo-modal-panel-width")),o=(s&&this.setWidth(s),this.get("transitionInPanel")),a=this.get("transitionOutPanel");!1!==e&&o&&a&&void 0!==p.Exo.animationEvent?(n.show().addClass("transitionIn exo-animate-"+o),this.$content.addClass("transitionOut exo-animate-"+a),n.on(p.Exo.animationEvent+".exo.modal",function(e){n.get(0)===e.currentTarget&&(n.off(p.Exo.animationEvent+".exo.modal"),n.removeClass("exo-animate-"+o+" transitionIn"),i.$content.removeClass("exo-animate-"+a+" transitionOut"),n.addClass("active"))}),t.addClass("transitionOut exo-animate-"+a),t.on(p.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&(t.off(p.Exo.animationEvent+".exo.modal"),t.removeClass("transitionOut exo-animate-"+a),t.find(".show").hide(),t.find(".hide").show(),t.addClass("active"),t.addClass("transitionIn exo-animate-"+o),t.on(p.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&t.off(p.Exo.animationEvent+".exo.modal")}))})):(t.find(".show").hide(),t.find(".hide").show(),t.removeClass("active"),n.show().addClass("active"))}},{key:"hidePanel",value:function(t,e){var i=this,s=(this.panelOpen=!1,t.data("exo-modal-panel")),n=this.$element.find(".exo-modal-panel[data-exo-modal-panel="+s+"]"),o=(this.setWidth(t.data("exo-modal-width")),this.get("transitionInPanel")),a=this.get("transitionOutPanel");!1!==e&&o&&a&&void 0!==p.Exo.animationEvent?(n.addClass("transitionOut exo-animate-"+a),this.$content.addClass("transitionIn exo-animate-"+o),n.on(p.Exo.animationEvent+".exo.modal",function(e){n.get(0)===e.currentTarget&&(n.off(p.Exo.animationEvent+".exo.modal"),n.removeClass("exo-animate-"+a+" transitionOut"),i.$content.removeClass("exo-animate-"+o+" transitionIn"),n.hide().removeClass("active"))}),t.addClass("transitionOut exo-animate-"+a),t.on(p.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&(t.off(p.Exo.animationEvent+".exo.modal"),t.removeClass("transitionOut exo-animate-"+a),t.find(".show").show(),t.find(".hide").hide(),t.removeClass("active"),t.addClass("transitionIn exo-animate-"+o),t.on(p.Exo.animationEvent+".exo.modal",function(e){t.get(0)===e.currentTarget&&t.off(p.Exo.animationEvent+".exo.modal")}))})):(t.find(".show").show(),t.find(".hide").hide(),t.removeClass("active"),n.hide().removeClass("active"))}},{key:"hidePanels",value:function(e){var t;this.hasOpenPanel()&&(t=this.$element.find(".exo-modal-panel-trigger.active")).length&&this.hidePanel(t,e)}},{key:"hasOpenPanel",value:function(){return!0===this.panelOpen}},{key:"set",value:function(e,t){switch(_get(_getPrototypeOf(o.prototype),"set",this).call(this,e,t),e){case"title":case"closeButton":case"fullscreen":case"subtitle":case"borderBottom":case"icon":case"iconText":this.createHeader(),this.bindElement()}return this}},{key:"getIframeResponsivePadding",value:function(){var e=0,t=parseInt(this.get("iframeWidth")),i=parseInt(this.get("iframeHeight"));return i<t&&(e=i/t*100),e=t<i?t/i*100:e}},{key:"setWidth",value:function(e){this.set("width",e),this.recalcSize()}},{key:"recalcSize",value:function(){var e,t,i,s,n=p.Exo.$window.width()-v.offsets.left-v.offsets.right,o=null!==this.get("left")&&!1!==this.get("left")&&""!==this.get("left")&&null!==this.get("right")&&!1!==this.get("right")&&""!==this.get("right")?n-(p.Exo.getMeasurementValue(this.get("left"))||0)-(p.Exo.getMeasurementValue(this.get("right"))||0):this.get("width"),a=(this.$element.css("max-width",o),this.get("height"));a&&this.$element.css("max-height",a),n<o+this.widthOffset?(this.isCompressed=!0,this.$element.addClass("isCompressed")):(this.isCompressed=!1,this.$element.removeClass("isCompressed")),p.Exo.isIE()&&1<o.toString().split("%").length&&(o=this.$element.outerWidth()),this.get("imageUrl")&&(this.isSetHeight=!0,this.$element.addClass("isSetHeight"),a=this.$content.find("> img"),o=n-50,n=p.Exo.$window.height()-v.offsets.top-v.offsets.bottom-50,e=a[0].naturalWidth,(a=a[0].naturalHeight)<e?(t=a/e,i=o,n<(s=Math.round(o*t))&&(i=Math.round(n/t),s=n)):(t=e/a,s=n,o<(i=Math.round(n*t))&&(i=o,s=Math.round(o/t))),this.$element.css("max-width",i+"px"),this.$element.css("max-height",s+"px"))}},{key:"recalcVerticalPos",value:function(e){null!==this.get("top")&&!1!==this.get("top")?(this.$element.css("margin-top",this.get("top")),0===this.get("top")&&this.$element.css({borderTopRightRadius:0,borderTopLeftRadius:0})):!1===e&&this.$element.css({marginTop:"",borderRadius:this.get("radius")}),null!==this.get("bottom")&&!1!==this.get("bottom")?(this.$element.css("margin-bottom",this.get("bottom")),0===this.get("bottom")&&this.$element.css({borderBottomRightRadius:0,borderBottomLeftRadius:0})):!1===e&&this.$element.css({marginBottom:"",borderRadius:this.get("radius")})}},{key:"recalcHorizontalPos",value:function(e){null!==this.get("left")&&!1!==this.get("left")?(this.$element.css("margin-left",this.get("left")),0===this.get("left")&&this.$element.css({borderTopLeftRadius:0,borderBottomLeftRadius:0})):!1===e&&this.$element.css({marginLeft:"",borderRadius:this.get("radius")}),null!==this.get("right")&&!1!==this.get("right")?(this.$element.css("margin-right",this.get("right")),0===this.get("right")&&this.$element.css({borderTopRightRadius:0,borderBottomRightRadius:0})):!1===e&&this.$element.css({marginRight:"",borderRadius:this.get("radius")})}},{key:"toggle",value:function(){this.state==this.states.OPENED&&this.close(),this.state==this.states.CLOSED&&this.open()}},{key:"shouldAutoOpen",value:function(){return this.get("autoOpen")&&!1===this.autoOpenProcessed}},{key:"autoOpen",value:function(){var e=this;this.shouldAutoOpen()&&this.$element.length&&(this.debug("Auto Open",this),this.autoOpenProcessed=!0,setTimeout(function(){e.open()}))}},{key:"callCallback",value:function(e){var t,i=this.get(e);i&&("string"==typeof i?(t=p.Exo.stringToCallback(i))&&t.object[t.function](this):"function"!=typeof i&&"object"!==_typeof(i)||i(this)),p.Exo.$window.trigger("exo-modal:"+e,[this])}},{key:"toggleContentSelector",value:function(){this.get("contentSelector")&&(this.state==this.states.CLOSED?(this.$contentPlaceholder||(this.$contentPlaceholder=f('<div class="exo-modal-placeholder data-exo-modal-placeholder="'+this.get("contentSelector")+'"></div>')),this.$contentSelection=f(this.get("contentSelector")),this.$contentSelection.length&&(this.$content=this.$element.find("."+this.name+"-content"),this.$contentPlaceholder.insertBefore(this.$contentSelection),this.$contentSelection.appendTo(this.$content))):(this.$contentSelection.insertBefore(this.$contentPlaceholder),this.$contentPlaceholder.remove()))}},{key:"open",value:function(t){var i=this;if(this.state==this.states.CLOSED){this.debug("log","Open","["+this.getId()+"]",this.getData());var s,e,n,o,a,l=this.get("ajaxUrl");if((!l&&this.get("ajax")||this.get("contentAjax"))&&(e=this.get("ajax")?this.get("ajax"):this.get("contentAjax"),l=this.addDestination(p.url(e)),this.set("ajaxUrl",l)),l&&!1===this.ajaxLoaded&&!1===this.contentAjaxLoaded)return e=p.ajax({progress:{type:"fullscreen"},base:(s=this).$trigger.attr("id"),element:this.$trigger[0],url:l,exoModal:this,exoModalParam:t}),n=e.options.success,e.options.success=function(e,t,i){s.ajaxLoaded=!0,s.contentAjaxLoaded=s.get("contentAjaxCache")&&!s.get("destroyOnClose"),n(e,t,i)},void e.execute();if(this.get("imageUrl")&&!1===this.imageLoaded)return(o=this.$element.find("."+this.name+"-content").first()).html('<div class="'+this.name+'-content-loader" style="height:80px"></div>'),void(a=f('<img src="'+this.get("imageUrl")+'" style="display:block;width:100%;height:100%;" />').on("load",function(e){i.imageLoaded=!0,i.set("width",null),o.html(""),o.append(a),i.open(t)}));if(this.ajaxLoaded=!1,this.toggleContentSelector(),this.buildContent(),p.ExoDisplace.calculate(),!0!==this.get("nest")&&p.ExoModal.closeAll(),this.state=this.states.OPENING,this.$element.trigger(this.states.OPENING),this.$element.removeAttr("aria-hidden"),!0===this.get("timeoutProgressbar")&&this.$element.find("."+this.name+"-progressbar > div").width("100%"),!0===this.get("iframe")){this.$content.addClass(this.name+"-content-loader");var r=this.$element.find("."+this.name+"-iframe"),l=(r.on("load.exo.modal",function(e){e=e.target;r.parent().removeClass(i.name+"-content-loader"),e.contentWindow.focus()}),null);try{l=""!==f(t.currentTarget).attr("href")?f(t.currentTarget).attr("href"):null}catch(e){}if(null==(l=null!==this.get("iframeURL")&&null==l?this.get("iframeURL"):l))throw new Error("Failed to find iframe URL");r.attr("src",l)}}(this.get("bodyOverflow")||p.Exo.isMobile())&&p.Exo.lockOverflow(this.$wrap),this.doOpen(t),!1===this.get("timeout")||isNaN(parseInt(this.get("timeout")))||!1===this.get("timeout")||0===this.get("timeout")||this.startProgress(this.get("timeout")),this.get("overlayClose")&&!this.$element.hasClass(this.get("transitionOut"))&&this.$overlay.on("click.exo.modal",function(){i.close()});function h(){i.recalcLayout(),i.timer=setTimeout(h,300)}setTimeout(function(){h()})}},{key:"doOpen",value:function(t){var i=this,s=(this.debug("log","Do Open","["+this.getId()+"]",t),this.$trigger.trigger("blur"),this.$element.closest("#exo-modals").length||f(".exo-fixed-float:not(.exo-fixed-not-invisible)").addClass("exo-fixed-invisible"),!0===this.get("overlay")&&(!1===this.get("appendToOverlay")?this.$overlay.prependTo(this.$element.parent()):(!0===this.get("appendToClosest")?this.$overlay.prependTo(this.$element.closest(this.get("appendToOverlay"))):this.$overlay.prependTo(this.get("appendToOverlay")),this.$overlay.closest(".exo-content").length&&this.$overlay.css({top:v.offsets.top,bottom:v.offsets.bottom,left:v.offsets.left,right:v.offsets.right}))),this.get("transitionIn")),n=this.get("transitionInOverlay"),e=null;(e="object"==_typeof(t)&&(void 0===t.transition&&void 0===t.transitionIn||(s=t.transition||t.transitionIn),void 0!==t.zindex&&this.setZindex(t.zindex),void 0!==t.previousModal)?t.previousModal:e)&&(e.getOverlay().hide(),this.$overlay.show(),n=null),n&&this.$overlay.addClass(n),""!==s&&void 0!==p.Exo.animationEvent?(this.$element.addClass("transitionIn "+s).css("display","flex"),this.event("opening").trigger(this),this.callCallback("onOpening"),this.$wrap.on(p.Exo.animationEvent+".exo.modal",function(e){i.$wrap.get(0)===e.currentTarget&&(i.$wrap.off(p.Exo.animationEvent+".exo.modal"),i.$element.removeClass(s+" transitionIn"),i.$overlay.removeClass(n),i.$navigate.removeClass("fadeIn"),i.opened(t))})):(this.$element.css("display","flex"),this.event("opening").trigger(this),this.callCallback("onOpening"),this.opened(t)),this.openNav(t),!0!==this.get("pauseOnHover")||!0!==this.get("pauseOnHover")||!1===this.get("timeout")||isNaN(parseInt(this.get("timeout")))||!1===this.get("timeout")||0===this.get("timeout")||(this.$element.off("mouseenter").on("mouseenter.exo.modal",function(e){e.preventDefault(),i.isPaused=!0}),this.$element.off("mouseleave").on("mouseleave.exo.modal",function(e){e.preventDefault(),i.isPaused=!1})),setTimeout(function(){i.$wrap.scrollTop(0),!0!==i.get("iframe")&&(i.get("focusInput")?i.$element.find(":input:not(button):enabled:visible:first").trigger("focus").filter("input:text").trigger("select"):i.$element.trigger("focus"))})}},{key:"opened",value:function(e){var t=this;this.bindElement(),this.state=this.states.OPENED,this.$element.trigger(this.states.OPENED),this.event("opened").trigger(this),this.callCallback("onOpened"),this.$element.addClass("isOpen"),p.Exo.$document.on("keydown."+this.name,function(e){27===e.which&&t.close()}),void 0!==p.drimage&&setTimeout(function(){p.drimage.init(t.$element.get(0))})}},{key:"openNav",value:function(e){var t,i,s=p.ExoModal.getGrouped(this.get("group"));1<s.count()&&(t=s.getPrev(this.getId(),this.get("loop")),s=s.getNext(this.getId(),this.get("loop")),i=null,"object"==_typeof(e)&&void 0!==e.previousModal&&(i=e.previousModal),!1===this.get("appendToNavigate")?this.$navigate.appendTo("body"):(!0===this.get("appendToClosest")?this.$navigate.appendTo(this.$element.closest(this.get("appendToNavigate"))):this.$navigate.appendTo(this.get("appendToNavigate")),this.$navigate.closest(".exo-content").length&&this.$navigate.css({top:v.offsets.top,bottom:v.offsets.bottom,left:v.offsets.left,right:v.offsets.right})),i||this.$navigate.addClass("fadeIn"),!0===this.get("navigateCaption")&&(null!==this.get("left")&&!1!==this.get("left")?this.$navigate.find("."+this.name+"-navigate-caption").css("right","10px"):this.$navigate.find("."+this.name+"-navigate-caption").css("left","10px")).show(),e=this.$element.outerWidth(),!1!==this.get("navigateArrows")?("closeScreenEdge"===this.get("navigateArrows")?(this.$navigate.find("."+this.name+"-navigate-prev").css("left",0).show(),this.$navigate.find("."+this.name+"-navigate-next").css("right",0)):(this.$navigate.find("."+this.name+"-navigate-prev").css("margin-left",-(e/2+84)).show(),this.$navigate.find("."+this.name+"-navigate-next").css("margin-right",-(e/2+84)))).show():(this.$navigate.find("."+this.name+"-navigate-prev").hide(),this.$navigate.find("."+this.name+"-navigate-next").hide()),t||this.$navigate.find("."+this.name+"-navigate-prev").hide(),s||this.$navigate.find("."+this.name+"-navigate-next").hide())}},{key:"close",value:function(e){var t,i,s=this;this.state!=this.states.OPENED&&this.state!=this.states.OPENING||(p.Exo.$document.off("keydown."+this.name),this.get("autoOpen")&&(this.dataOriginal={}),this.state=this.states.CLOSING,this.$element.trigger(this.states.CLOSING),this.$element.attr("aria-hidden","true"),this.$element.closest("#exo-modals").length||f(".exo-fixed-float:not(.exo-fixed-not-invisible)").removeClass("exo-fixed-invisible"),clearTimeout(this.timer),clearTimeout(this.timerTimeout),clearInterval(this.timerInterval),this.event("closing").trigger(this),this.callCallback("onClosing"),t=this.get("transitionOut"),i=this.get("transitionOutOverlay"),null!==this.get("transitionOutTemp")&&(t=this.get("transitionOutTemp"),this.set("transitionOutTemp",null)),!1===(t="object"!=_typeof(e)||void 0===e.transition&&void 0===e.transitionOut?t:e.transition||e.transitionOut)||""===t||void 0===p.Exo.animationEvent?(this.$element.hide(),this.$overlay.remove(),this.$navigate.remove(),this.closed()):(this.$element.attr("class",[this.class,this.name,t,!0===this.isFullscreen?"isFullscreen":"",!0===this.isCompressed?"isCompressed":"",this.isSetHeight?"isSetHeight":"",!0===this.isTall?"isTall":"",this.get("rtl")?this.name+"-rtl":""].join(" ")),i&&this.$overlay.attr("class",this.name+"-overlay "+i),!1===this.get("navigateArrows")||p.Exo.isMobile()||this.$navigate.attr("class",this.name+"-navigate fadeOut"),this.$element.on(p.Exo.animationEvent+".exo.modal",function(e){e.target===e.currentTarget&&(s.$element.off(p.Exo.animationEvent+".exo.modal"),s.$element.hasClass(t)&&s.$element.removeClass(t+" transitionOut").hide(),s.$overlay.hasClass(i)&&s.$overlay.removeClass(i).remove(),s.$navigate.removeClass("fadeOut").remove(),s.closed())})))}},{key:"closed",value:function(e){this.toggleContentSelector(),this.state=this.states.CLOSED,this.$element.trigger(this.states.CLOSED),!0===this.get("iframe")&&this.$element.find("."+this.name+"-iframe").attr("src",""),(this.get("bodyOverflow")||p.Exo.isMobile())&&0===p.ExoModal.getVisible().count()&&p.Exo.unlockOverflow(this.$wrap),this.event("closed").trigger(this),this.callCallback("onClosed"),this.$element.removeClass("isOpen"),!0===this.get("restoreDefaultContent")&&this.$content.html(this.content),0===f("."+this.name+":visible").length&&f("html").removeClass(this.name+"-isAttached"),this.get("contentAjax")&&(this.$element.insertAfter(this.$contentAjaxPlaceholder),this.rebuildContent()),this.get("destroyOnClose")&&this.destroy(e)}},{key:"destroy",value:function(e){this.debug("log","Destroy","["+this.getId()+"]");var t=f.Event("destroy");this.$element.trigger(t),p.Exo.$document.off("keydown."+this.name),clearTimeout(this.timer),clearTimeout(this.timerTimeout),!0===this.get("iframe")&&this.$element.find("."+this.name+"-iframe").remove(),p.detachBehaviors(this.$element.get(0),a),this.$element.html(this.$content.html()),this.$element.off("click","[data-"+this.name+"-close]"),this.$element.off("click","[data-"+this.name+"-fullscreen]"),this.$element.off("."+this.name).removeData(this.name).attr("style","").remove(),this.$contentAjaxPlaceholder&&this.$contentAjaxPlaceholder.remove(),this.$contentAjaxPlaceholder=null,this.contentAjaxLoaded=!1,this.$overlay.remove(),this.$navigate.remove(),this.$element.trigger(this.states.DESTROYED),this.$element=null,this.autoOpenProcessed=!1,this.state=this.states.CLOSED,this.built=!1}},{key:"bindElement",value:function(){var t=this;this.bindClose(),this.$element.off("click.exo.modal","[data-"+this.name+"-fullscreen]").on("click.exo.modal","[data-"+this.name+"-fullscreen]",function(e){e.preventDefault(),!0===t.isFullscreen?(t.isFullscreen=!1,t.$element.addClass("exo-no-transitions").removeClass("isFullscreen")):(t.isFullscreen=!0,t.$element.addClass("exo-no-transitions isFullscreen")),setTimeout(function(){t.$element.removeClass("exo-no-transitions")},300),p.Exo.checkElementPosition(),t.$element.trigger("fullscreen",t),t.callCallback("onFullscreen")}),this.$navigate.off("click.exo.modal","."+this.name+"-navigate-next").on("click.exo.modal","."+this.name+"-navigate-next",function(e){e.preventDefault(),t.next(e)}),this.$element.off("click.exo.modal","[data-"+this.name+"-next]").on("click.exo.modal","[data-"+this.name+"-next]",function(e){e.preventDefault(),t.next(e)}),this.$navigate.off("click.exo.modal","."+this.name+"-navigate-prev").on("click.exo.modal","."+this.name+"-navigate-prev",function(e){e.preventDefault(),t.prev(e)}),this.$element.off("click.exo.modal","[data-"+this.name+"-prev]").on("click.exo.modal","[data-"+this.name+"-prev]",function(e){e.preventDefault(),t.prev(e)})}},{key:"bindClose",value:function(){var t=this;this.$element.find("[data-"+this.name+"-close]").off("click.exo.modal").on("click.exo.modal",function(e){e.preventDefault();e=f(e.currentTarget).attr("data-"+t.name+"-transitionOut");void 0!==e?t.close({transition:e}):t.close()}).attr("tabindex",0).attr("aria-label","Close modal")}},{key:"startProgress",value:function(e){var t=this;this.isPaused=!1,clearTimeout(this.timerTimeout),clearInterval(this.timerInterval),!0===this.get("timeoutProgressbar")?(this.progressBar={hideEta:null,maxHideTime:null,currentTime:(new Date).getTime(),el:this.$element.find("."+this.name+"-progressbar > div"),updateProgress:function(){var e;t.isPaused||(t.progressBar.currentTime=t.progressBar.currentTime+10,e=(t.progressBar.hideEta-t.progressBar.currentTime)/t.progressBar.maxHideTime*100,t.progressBar.el.width(e+"%"),e<0&&t.close())}},0<e&&(this.progressBar.maxHideTime=parseFloat(e),this.progressBar.hideEta=(new Date).getTime()+this.progressBar.maxHideTime,this.timerInterval=setInterval(this.progressBar.updateProgress,10))):this.timerTimeout=setTimeout(function(){t.close()},this.get("timeout"))}},{key:"pauseProgress",value:function(){this.isPaused=!0}},{key:"resumeProgress",value:function(){this.isPaused=!1}},{key:"resetProgress",value:function(e){clearTimeout(this.timerTimeout),clearInterval(this.timerInterval),this.progressBar={},this.$element.find("."+this.name+"-progressbar > div").width("100%")}},{key:"recalcLayout",value:function(){var e,t,i,s,n,o,a,l,r,h,d,c,m,g=this;this.state!=this.states.OPENED&&this.state!=this.states.OPENING||(e=p.Exo.$window.height()-(v.offsets.top+v.offsets.bottom),t=p.Exo.$window.width()-(v.offsets.left+v.offsets.right),i=this.$element.outerHeight(),h=this.$element.outerWidth(),s=this.$content[0].scrollHeight,d=this.$sectionHeader.outerHeight()||0,c=this.$sectionFooter.outerHeight()||0,n=this.$wrap.scrollTop(),o=this.$content.innerHeight()-this.$content.height(),a=this.$content.innerWidth()-this.$content.width(),l=0,r=!1,p.Exo.isIE()&&(h>=p.Exo.$window.width()||!0===this.isFullscreen)&&this.$element.css({left:"0",marginLeft:""}),!0===this.get("borderBottom")&&""!==this.get("title")&&!1===this.get("hideTitle")&&(l=3),this.headerHeight=0,this.$element.find("."+this.name+"-header").length&&this.$element.find("."+this.name+"-header").is(":visible")&&(this.headerHeight=this.$element.find("."+this.name+"-header").innerHeight()),this.footerHeight=0,this.$element.find("."+this.name+"-footer").length&&this.$element.find("."+this.name+"-footer").is(":visible")&&(this.footerHeight=this.$element.find("."+this.name+"-footer").innerHeight()),h=this.headerHeight+this.footerHeight+d+c,d=this.$element.outerHeight()-h,c=0,this.isSetHeight?(c=i,r=!0):c=s+h,this.$element.find("."+this.name+"-loader").length&&this.$element.find("."+this.name+"-loader").css("top",this.headerHeight),i!==this.modalHeight&&(this.modalHeight=i,this.callCallback("onResize")),!0===this.get("iframe")?null!==this.get("iframeHeight")&&null!==this.get("iframeWidth")&&!0===this.get("iframeResponsive")?e<=this.$element.outerHeight()||!0===this.isFullscreen?(m=e/this.$element.outerHeight(),this.$element.css("max-width",this.$element.width()*m)):this.recalcSize():e<this.get("iframeHeight")+h+l||!0===this.isFullscreen?this.$element.find("."+this.name+"-iframe").css("height",Math.round(e-(h+l+o))):this.$element.find("."+this.name+"-iframe").css("height",this.get("iframeHeight")):1===this.$element.find("."+this.name+"-expand:visible").length?(this.$element.find("."+this.name+"-expand").height(e-(h+l+o)).width(t-a),this.$element.css("max-width","")):this.recalcSize(),i==e?this.$element.addClass("isAttached"):this.$element.removeClass("isAttached"),!1===this.isFullscreen&&this.$element.width()>=p.Exo.$window.width()?this.$element.find("."+this.name+"-button-fullscreen").hide():this.$element.find("."+this.name+"-button-fullscreen").show(),this.recalcButtons(),(e=!1===this.isFullscreen?e-(p.Exo.getMeasurementValue(this.get("top"))||0)-(p.Exo.getMeasurementValue(this.get("bottom"))||0):e)<c?(0<this.get("top")&&null===this.get("bottom")&&s<p.Exo.$window.height()&&this.$element.addClass("isAttachedBottom"),0<this.get("bottom")&&null===this.get("top")&&s<p.Exo.$window.height()&&this.$element.addClass("isAttachedTop"),1===f("."+this.name+":visible").length&&f("html").addClass(this.name+"-isAttached"),this.$element.css("height",e)):(!0===this.isTall||this.get("top")&&this.get("bottom")?this.$element.css("height",e):this.isSetHeight||this.$element.css("height",s+(h+l)),this.$element.removeClass("isAttachedTop isAttachedBottom"),1===f("."+this.name+":visible").length&&f("html").removeClass(this.name+"-isAttached")),d<s&&(r||e<c)?(g.$element.addClass("hasScroll"),g.$wrap.css("height",i-(h+l))):(g.$element.removeClass("hasScroll"),g.$wrap.css("height","")),d+n<s-30?g.$element.addClass("hasShadow"):g.$element.removeClass("hasShadow"))}},{key:"recalcButtons",value:function(){var e=this.$header.find("."+this.name+"-header-buttons").innerWidth()+10;!0===this.get("rtl")?this.$header.css("padding-left",e):this.$header.css("padding-right",e)}},{key:"next",value:function(e){var t,i,s=p.ExoModal.getGrouped(this.get("group")).getNext(this.getId(),this.get("loop"));s&&(t=this.get("transitionOut")===this.defaults.transitionOut?"fadeOutLeft":this.get("transitionOut"),i=s.get("transitionIn")===this.defaults.transitionIn?"fadeInRight":s.get("transitionIn"),this.set("transitionOutTemp",t),s.open({transition:i,previousModal:this}))}},{key:"prev",value:function(e){var t,i,s=p.ExoModal.getGrouped(this.get("group")).getPrev(this.getId(),this.get("loop"));s&&(t=this.get("transitionOut")===this.defaults.transitionOut?"fadeOutRight":this.get("transitionOut"),i=s.get("transitionIn")===this.defaults.transitionIn?"fadeInLeft":s.get("transitionIn"),this.set("transitionOutTemp",t),s.open({transition:i,previousModal:this}))}},{key:"bindTrigger",value:function(){var t=this,e=this.getTriggerElement();e.length&&e.off("click.exo.modal."+this.getId()).on("click.exo.modal."+this.getId(),function(e){e.preventDefault(),t.toggle()}).off("keydown.exo.modal."+this.getId()).on("keydown.exo.modal."+this.getId(),function(e){switch(e.which){case 13:case 32:e.preventDefault(),e.stopPropagation(),t.toggle()}})}},{key:"addDestination",value:function(e){var t,i=e.split("?"),s=null;return(s=i[1]?new URLSearchParams("?"+i[1]).get("destination"):s)||(i="destination",s=window.location.pathname,i=encodeURI("destination"),s=encodeURI(s),t=e&&-1!==e.indexOf("?"),e+=(t?"&":"?")+i+"="+s),e}},{key:"isOpen",value:function(){return this.state===this.states.OPENED||this.state===this.states.OPENING}},{key:"getState",value:function(){return this.state}},{key:"getSelector",value:function(){return this.getId().replace(/_/g,"-")}},{key:"getSelectorAsId",value:function(){return"#"+this.getSelector()}},{key:"getTriggerElement",value:function(){return this.$trigger=f("."+this.getSelector()+"-trigger"),this.$trigger}},{key:"getElement",value:function(){var e=f("."+this.getSelector());return this.$element=e.first(),1<e.length&&e.each(function(e,t){0!==e&&f(t).remove()}),this.$element}},{key:"getOverlay",value:function(){return this.$overlay}}]),o}(),e=function(){_inherits(s,ExoDataManager);var t=_createSuper(s);function s(){var e;return _classCallCheck(this,s),(e=t.call(this)).label="Modals",e.doDebug=!1,e.settingsGroup="exoModal",e.instanceSettingsGroup="modals",e.instanceClass=i,e.globalWrapper="#exo-modals",e.events={opening:new ExoEvent,opened:new ExoEvent,closing:new ExoEvent,closed:new ExoEvent},e.$wrapper=f(e.globalWrapper),e.buildBindings(),e}return _createClass(s,[{key:"addInstance",value:function(e,t){var i=this;t.event("opening").on("modals",function(e){i.event("opening").trigger(e),e.get("appendTo")===i.globalWrapper&&i.$wrapper.addClass("exo-modals-active").removeAttr("aria-hidden")}),t.event("opened").on("modals",function(e){i.event("opened").trigger(e)}),t.event("closing").on("modals",function(e){i.event("closing").trigger(e)}),t.event("closed").on("modals",function(e){i.event("closed").trigger(e),0===i.getVisible(!0).count()&&i.$wrapper.removeClass("exo-modals-active").attr("aria-hidden","true")}),_get(_getPrototypeOf(s.prototype),"addInstance",this).call(this,e,t)}},{key:"buildBindings",value:function(){var s=this;p.Exo.$document.off("keydown.exo.modal").on("keydown.exo.modal",function(i){s.getVisible().each(function(e){var t=f(i.target);e.getElement().find(i.target).length&&(13===i.which&&e.getElement().find("form").length&&!e.getElement().find(".ck-editor").length?t.has("[data-autocomplete-path]").length||t.hasClass("ui-autocomplete-input")||t.is("textarea")||e.getElement().find("form .form-submit:first").mousedown():27===i.which&&e.get("closeOnEscape")&&e.close())})}),p.Exo.$document.off("keyup.exo.modal").on("keyup.exo.modal",function(t){var e=t.target;t.ctrlKey||t.metaKey||t.altKey||"INPUT"===e.tagName.toUpperCase()||"TEXTAREA"==e.tagName.toUpperCase()||s.getVisible().each(function(e){e.get("group")&&1<p.ExoModal.getGrouped(e.get("group")).count()&&(37===t.which?e.prev(t):39===t.which&&e.next(t))})}),p.ExoDisplace.event("changed").on("exo.modal",function(e){s.resizeWrapper()})}},{key:"closeAll",value:function(){this.getVisible().each(function(e){e.close()})}},{key:"close",value:function(e){var t=this.getInstance(e);t?t.close():this.debug("error","Count not find modal to close",e)}},{key:"getVisible",value:function(t){var i=this,s=new ExoDataCollection;return t=!0===t,this.getInstances().each(function(e){e.isOpen()&&(!1===t||!0===t&&e.get("appendTo")===i.globalWrapper)&&s.add(e)}),s}},{key:"getVisibleFocus",value:function(e){var i=0,s=null;return this.getVisible(e).each(function(e){var t=e.get("zindex");i<=t&&(i=t,s=e)}),s}},{key:"getById",value:function(i){var s=this;return new Promise(function(t,e){s.getInstances().each(function(e){e.getId()===i&&t(e)})})}},{key:"getGrouped",value:function(t){var e,i,s=new ExoDataCollection;return""!==t&&(e=this.getInstances(),i=e.count(),e.each(function(e){e.get("group")===t&&(e.setWeight(i),s.add(e),i--)})),s}},{key:"getWrapper",value:function(){return this.$wrapper}},{key:"resizeWrapper",value:function(){this.getWrapper().css({top:p.ExoDisplace.offsets.top,bottom:p.ExoDisplace.offsets.bottom,left:p.ExoDisplace.offsets.left,right:p.ExoDisplace.offsets.right})}},{key:"event",value:function(e){return void 0!==this.events[e]?this.events[e].expose():null}}]),s}();p.ExoModal=new e,p.behaviors.exoModal={attach:function(e){p.ExoModal.attach(e);var t=p.ExoModal.getVisibleFocus();t&&t.getElement().find(e).length&&t.refreshContent()}}}(jQuery,(_,Drupal),drupalSettings,Drupal.displace);