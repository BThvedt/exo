"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}!function(a,h,n,c){var o=null,i=function(){function i(e){var t=this;_classCallCheck(this,i),this.debug=!1,this.open=!1,this.uniqueId=h.Exo.guid(),this.isIos=h.Exo.isIos(),this.isIpadOs=h.Exo.isIpadOs(),this.isMobile=h.Exo.isMobile(),this.isSafari=h.Exo.isSafari(),this.supported=this.isSupported(),this.$element=e,this.$field=this.$element.find("select"),this.multiple=!!this.$field.attr("multiple"),this.hasError()&&this.$element.addClass("invalid"),this.$trigger=this.$element.find(".exo-form-select-trigger").attr("id","exo-form-select-trigger-"+this.uniqueId).prop("disabled",this.isDisabled()),this.$wrapper=e.find(".exo-form-select-wrapper"),this.$caret=this.$element.find(".exo-form-select-caret"),this.$label=e.closest(".exo-form-select").find("label").first(),this.placeholder=this.$field.attr("placeholder")||(this.multiple?"Select Multiple":"Select One"),this.$label.attr("id","exo-form-select-label-"+this.uniqueId),this.$trigger.text(this.placeholder),this.$hidden=this.$element.find(".exo-form-select-hidden"),this.supported?(this.$hidden.attr("id","exo-form-select-hidden-"+this.uniqueId).attr("aria-labelledby","exo-form-select-label-"+this.uniqueId+" exo-form-select-trigger-"+this.uniqueId+" exo-form-select-hidden-"+this.uniqueId),this.multiple?this.$hidden.attr("aria-label","Select Option"):this.$hidden.attr("aria-label","Select Options"),this.isDisabled()&&this.$hidden.prop("disabled",!0).attr("tabindex","-1"),this.$field.attr("tabindex")&&this.$hidden.attr("tabindex",this.$field.attr("tabindex")),this.isSafari||this.isIpadOs||this.$field.attr("tabindex","-1"),this.$dropdownWrapper=a("#exo-form-select-dropdown-wrapper"),this.$dropdownWrapper.length||(this.$dropdownWrapper=a('<div id="exo-form-select-dropdown-wrapper" class="exo-form"></div>'),h.Exo.getBodyElement().append(this.$dropdownWrapper)),this.$dropdown=a('<div class="exo-form-select-dropdown exo-form-input" role="combobox" aria-owns="exo-form-select-scroll-'+this.uniqueId+'" aria-expanded="false"></div>'),this.$dropdownScroll=a('<ul id="exo-form-select-scroll-'+this.uniqueId+'" class="exo-form-select-scroll" role="listbox" aria-labelledby="exo-form-select-label-'+this.uniqueId+'" tabindex="-1"></div>').appendTo(this.$dropdown),this.$dropdownWrapper.append(this.$dropdown),this.$dropdown.addClass(this.multiple?"is-multiple":"is-single"),!0===this.hasValue()&&this.$element.addClass("filled")):this.$hidden.remove(),this.build(),this.evaluate(),this.bind(),setTimeout(function(){t.$element.addClass("ready")})}return _createClass(i,[{key:"destroy",value:function(){this.unbind(),this.$dropdown.remove(),this.$element.removeData()}},{key:"build",value:function(){var e=this;this.loadOptionsFromSelect(),this.updateTrigger(),this.debug&&(this.$field.show(),setTimeout(function(){e.$trigger.trigger("tap")},500))}},{key:"evaluate",value:function(){var e=this.isRequired(),t=this.isDisabled();this.$field.prop("required",e),this.$trigger.prop("disabled",t),t?this.$element.addClass("form-disabled"):this.$element.removeClass("form-disabled"),this.multiple&&(e=this.$dropdown.find(".exo-form-checkbox"),t?e.addClass("form-disabled"):e.removeClass("form-disabled"),e.find(".form-checkbox").prop("disabled",t))}},{key:"bind",value:function(){function t(){i.hasValue()?i.$element.addClass("value"):i.$element.removeClass("value")}var i=this;this.$trigger.on("focus.exo.form.select",function(e){i.$trigger.trigger("blur")}).on("click.exo.form.select",function(e){e.preventDefault()}).on("tap.exo.form.select",function(e){i.supported?i.showDropdown():e.preventDefault()}),this.$field.on("state:disabled.exo.form.select",function(e){i.evaluate()}).on("state:required.exo.form.select",function(e){i.evaluate()}).on("state:visible.exo.form.select",function(e){i.evaluate()}).on("state:collapsed.exo.form.select",function(e){i.evaluate()});this.supported?(this.$dropdown.on("tap.exo.form.select",".selector",function(e){i.onItemTap(e)}),this.$dropdown.on("tap.exo.form.select",".close",function(e){i.closeDropdown()}),this.$hidden.on("focusin.exo.form.select",function(e){null!==o&&o.closeDropdown(),i.$wrapper.addClass("focused")}).on("blur.exo.form.select",function(e){i.$wrapper.removeClass("focused")}).on("keydown.exo.form.select",function(e){i.onHiddenKeydown(e)}).on("keyup.exo.form.select",function(e){e.preventDefault()}).on("click.exo.form.select",function(e){e.preventDefault(),i.showDropdown()}),this.$field.on("focus.exo.form.select",function(e){i.isSafari&&i.$hidden.trigger("focus"),i.isIpadOs&&i.$hidden.trigger("click")}).on("change.exo.form.select",function(e){i.loadOptionsFromSelect(),i.updateTrigger()}).on("input.exo.form.select",function(e){t()}),t(),this.$field.attr("autofocus")&&this.showDropdown()):(this.$field.addClass("overlay"),this.$field.on("change.exo.form.select",function(e){i.loadOptionsFromSelect(),i.updateTrigger()}).on("focus.exo.form.select",function(e){i.isIos&&i.$wrapper.addClass("focused")}).on("blur.exo.form.select",function(e){i.isIos&&i.$wrapper.removeClass("focused")}).on("input.exo.form.select",function(e){t()}),t())}},{key:"unbind",value:function(){this.$element.off(".exo.form.select"),this.$dropdown.off(".exo.form.select"),this.$dropdown.find(".search-input").off(".exo.form.select"),this.$field.off(".exo.form.select"),a("body").off(".exo.form.select")}},{key:"onChange",value:function(e){}},{key:"onItemTap",value:function(e){var t,e=a(e.currentTarget),i=e.parent(),o=e.data("option");return this.multiple?(this.$dropdown.find(".selector.selected").removeClass("selected"),e.is(".active")?(t="remove",e.removeClass("active"),e.find("input").prop("checked",!1).trigger("change")):(t="add",e.addClass("active selected"),e.find("input").prop("checked",!0).trigger("change")),this.changeSelected(o,t)):(i.find(".active, .selected").removeClass("active selected").removeAttr("aria-selected"),e.addClass("active selected").attr("aria-selected","true"),this.changeSelected(o,"add"),this.closeDropdown(!0))}},{key:"onSearchKeydown",value:function(e){var t,i,o,s;{if(this.open)return 9===e.which?((t=this.$dropdown.find(".selector.selected")).length&&(i=t.data("option"),this.changeSelected(i,"add")),i=this.$element.closest("form").find(":input").not(".ignore").not('[tabindex="-1"]'),o=null,s=i.index(this.$hidden),i.each(function(e,t){null===o&&s<e&&a(t).not('[tab-index="-1"]')&&(o=a(t))}),null!==o&&(o.focus(),e.preventDefault()),this.closeDropdown()):27===e.which?this.closeDropdown(!0):(13===e.which&&((t=this.$dropdown.find(".selector.selected")).length&&t.trigger("tap"),e.preventDefault()),40!==e.which&&39!==e.which||(this.highlightOption(this.$dropdown.find(".selector.selected").nextAll(".selector:not(.hide):visible").first(),!0,!0),e.preventDefault()),void(38!==e.which&&37!==e.which||(this.highlightOption(this.$dropdown.find(".selector.selected").prevAll(".selector:not(.hide):visible").first(),!0,!0),e.preventDefault())));e.preventDefault()}}},{key:"onSearchKeyup",value:function(e){var i,t;!this.open||!this.isAlphaNumberic(e.which)&&8!==e.which||((i=a(e.currentTarget).val().toString().toLowerCase())?(t=this.$dropdown.find(".selector"),(t=this.multiple?t.filter(":not(.active)"):t).each(function(e,t){0<=a(t).data("option").text.toLowerCase().indexOf(i)?a(t).removeClass("hide"):a(t).addClass("hide")}),this.$dropdown.find(".optgroup").removeClass("hide").each(function(e,t){t=a(t);t.nextUntil(".optgroup").filter(":not(.hide)").length||t.addClass("hide")})):this.$dropdown.find(".hide").removeClass("hide"),this.highlightOption(this.$dropdown.find(".selector:not(.hide):visible").first())),e.preventDefault()}},{key:"isAlphaNumberic",value:function(e){e=String.fromCharCode(e);return/[a-zA-Z0-9-_ ]/.test(e)}},{key:"onHiddenKeydown",value:function(e){if(!this.open&&!0!==e.metaKey&&9!==e.which){var t,i;if(37===e.which&&!this.multiple)return t=this.$dropdown.find(".selector.selected").prevAll(".selector:not(.hide):visible").first(),this.highlightOption(t,!0,!0),i=t.data("option"),this.changeSelected(i,"add"),void e.preventDefault();if(39===e.which&&!this.multiple)return t=this.$dropdown.find(".selector.selected").nextAll(".selector:not(.hide):visible").first(),this.highlightOption(t,!0,!0),i=t.data("option"),this.changeSelected(i,"add"),void e.preventDefault();if(this.isAlphaNumberic(e.which)||38===e.which||40===e.which){if(38===e.which||40===e.which)return e.which=13,e.preventDefault(),void this.showDropdown();13!==e.which&&(39!==e.which&&37!==e.which&&17!==e.which&&18!==e.which&&32!==e.which&&(-1===[9,13,27,37,38,39,40].indexOf(e.which)&&(e.preventDefault(),this.showDropdown(),t=e.which||e.which,i=String.fromCharCode(t).toLowerCase(),this.$dropdown.find(".search-input").val(i),this.onSearchKeyup(e))),e.preventDefault())}else e.preventDefault()}}},{key:"populateDropdown",value:function(){for(var t=this,e=(this.$dropdownScroll.find("li").remove(),0===this.$dropdown.find(".search-input").length&&this.$dropdown.prepend('<div class="close" aria-label="Close">&times;</div>').prepend('<div class="search"><input type="text" class="exo-form-input-item simple search-input" aria-autocomplete="list" aria-controls="exo-form-select-scroll-'+this.uniqueId+'" tabindex="-1"></input></div>').find(".search-input").attr("placeholder",this.placeholder).on("keydown.exo.form.select",function(e){t.onSearchKeydown(e)}).on("keyup.exo.form.select",function(e){t.onSearchKeyup(e)}),this.$dropdown.find(".search-input").attr("placeholder","Search..."),this.getAllOptions()),i=0;i<e.length;i++){var o=e[i],s="exo-form-option-"+this.uniqueId+"-"+i,r=a('<li role="option" role="listitem" tabindex="-1"></li>');if(o.group)r.addClass("optgroup"),r.html("<span>"+o.text+"</span>");else if(this.multiple){if(!this.isRequired()&&"_none"===o.value)continue;r.addClass("selector exo-form-checkbox ready"),r.html('<span><input id="'+s+'" type="checkbox" class="form-checkbox"><label for="'+s+'" class="option">'+o.text+'<div class="exo-ripple"></div></label></span>')}else r.addClass("selector"),r.html("<span>"+o.text+"</span>");o.selected&&(r.addClass("active").attr("aria-selected","true"),r.find("input").prop("checked",!0)),r.data("option",o),this.$dropdownScroll.append(r)}this.multiple&&this.$dropdownScroll.find(".form-checkbox").on("change",function(e){t.highlightOption(a(e.currentTarget).closest(".selector"),!1),t.isIos||t.$dropdown.find(".search-input").focus()}),this.highlightOption(),h.attachBehaviors(this.$dropdownScroll[0])}},{key:"getAllOptions",value:function(e){if(!e)return this.selected;for(var t=[],i=0;i<this.selected.length;i++)t.push(this.selected[i][e]);return t}},{key:"loadOptionsFromSelect",value:function(){var s=this;this.selected=[],this.$field.find("option, optgroup").each(function(e,t){var i=a(t),o={value:"",text:"",selected:!1,group:!1};i.is("optgroup")?(o.text=a(t).attr("label"),o.group=!0):(o.value=i.attr("value"),o.text=i.html(),o.selected=i.is(":selected")),s.selected.push(o)})}},{key:"updateTrigger",value:function(){var e=this.getSelectedOptions("value").join("");null===e||""===e||"_none"===e?(this.$trigger.val(""),this.$trigger.attr("placeholder",this.htmlDecode(this.getSelectedOptions("text").join(", ")))):this.$trigger.val(this.htmlDecode(this.getSelectedOptions("text").join(", ")))}},{key:"getSelectedOptions",value:function(e){for(var t=[],i=0;i<this.selected.length;i++)this.selected[i].selected&&(e?t.push(this.selected[i][e]):t.push(this.selected[i]));return t}},{key:"changeSelect",value:function(e,t){for(var i=!1,o=0;o<this.selected.length;o++)this.multiple||(this.selected[o].selected=!1),this.selected[o].value===e.value&&(i=!0,"add"===t?this.selected[o].selected=!0:"remove"===t&&(this.selected[o].selected=!1));this.updateTrigger(),this.multiple&&this.updateSearch(),this.updateSelect(i?null:e)}},{key:"updateSelect",value:function(e){e&&(e=a("<option></option>").attr("value",e.value).html(e.text),this.$field.append(e)),this.$field.val(this.getSelectedOptions("value")),this.$field.trigger("change",[!0]),this.$field.trigger("input",[!0])}},{key:"changeSelected",value:function(e,t){for(var i=!1,o=!1,s=0;s<this.selected.length;s++)this.multiple||(this.selected[s].selected=!1),this.selected[s].value===e.value&&(i=!0,"add"===t?this.selected[s].selected=!0:"remove"===t&&(this.selected[s].selected=!1)),this.multiple&&"_none"!==this.selected[s].value&&this.selected[s].selected&&(o=!0);if(this.multiple)for(s=0;s<this.selected.length;s++)"_none"===this.selected[s].value&&(this.selected[s].selected=!o);this.updateTrigger(),this.multiple&&this.updateSearch(),this.updateSelect(i?null:e)}},{key:"updateSearch",value:function(){this.$dropdown.find(".search-input").attr("placeholder",this.getSelectedOptions("text").join(", "))}},{key:"highlightOption",value:function(e,t,i){!1!==t&&(t=!0),(e=!(e=e||this.$dropdownScroll.find(".selector.active:eq(0)")).length&&i?this.$dropdownScroll.find(".selector:eq(0)"):e).length&&(this.$dropdown.find(".selector.selected").removeClass("selected").removeAttr("aria-selected"),e.addClass("selected").attr("aria-selected","true"),this.$dropdown.find(".search-input").attr("aria-activedescendant",e.attr("id")),this.$hidden.attr("aria-activedescendant",e.attr("id")),t&&this.highlightScrollTo(e))}},{key:"highlightScrollTo",value:function(e){var t,i,o;(e=e||this.$dropdown.find(".selector.selected")).length&&(t=this.$dropdownScroll.scrollTop(),i=this.$dropdownScroll.outerHeight(),o=this.$dropdownScroll.offset().top,i+t<(o=t+e.offset().top-o)+(e=e.outerHeight())?this.$dropdownScroll.scrollTop(o+e-i):o<t&&this.$dropdownScroll.scrollTop(o))}},{key:"hasValue",value:function(){var e=this.$field.val();return e&&"object"===_typeof(e)?0<e.length:""!==e&&"- Any -"!==e&&"_none"!==e}},{key:"hasError",value:function(){return this.$field.hasClass("error")}},{key:"showDropdown",value:function(){var e=this;if(a("body").trigger("tap"),this.open)return this.closeDropdown();this.populateDropdown(),this.open=!0,(o=this).$dropdownScroll.css("max-height",""),this.positionDropdown(),h.Exo.lockOverflow(this.$dropdown),h.Exo.showShadow({opacity:.2}),this.$element.addClass("active"),this.$wrapper.addClass("focused"),this.$dropdown.addClass("active").find(".search-input").focus(),this.$dropdownWrapper.attr("class",this.$element.closest("form").attr("class")).addClass("exo-form-select-dropdown-wrapper").css({padding:0,margin:0}),this.isIos&&this.$dropdown.find(".search-input").trigger("blur"),this.highlightScrollTo(),setTimeout(function(){e.$element.addClass("animate"),e.$dropdown.addClass("animate").attr("aria-expanded","true")},50),this.windowHideDropdown()}},{key:"windowHideDropdown",value:function(){var t=this;a("body").on("tap."+this.uniqueId,function(e){!t.open||a(e.target).closest(t.$dropdown).length||t.closeDropdown()})}},{key:"positionDropdown",value:function(){if(!0===this.open){var e=h.Exo.$window.scrollTop(),t=h.Exo.$window.height(),i=e+t,o=this.$wrapper.offset().top,s=this.$dropdown.outerHeight(),r=o+s,n=(a(".exo-fixed-header .exo-fixed-element").outerHeight()||0)+c.offsets.top,l=(this.$dropdown.removeClass("from-top from-bottom").css({left:this.$trigger.offset().left,width:this.$trigger.outerWidth()}),"top");switch(t-n<s||this.isMobile&&!this.isIos?(s=t-n-this.$dropdown.find(".search-input").height()-20,this.$dropdownScroll.css("max-height",s),h.Exo.$window.scrollTop(o-n-10)):r<i||(e+n<o-s?l="bottom":h.Exo.$window.scrollTop(o-n-(i-(e+n)-s)/2)),l){case"top":this.$dropdown.addClass("from-top").css("top",this.$trigger.offset().top);break;case"bottom":var d=h.Exo.$document.height()-(this.$trigger.offset().top+this.$trigger.outerHeight());this.$dropdown.addClass("from-bottom").css("bottom",d)}}}},{key:"closeDropdown",value:function(e){var t=this;!0===this.open&&(this.open=!1,o=null,this.$dropdown.attr("aria-expanded","false"),this.$dropdown.removeClass("animate").find(".search-input").val(""),this.$element.removeClass("animate"),this.$wrapper.removeClass("focused"),this.updateSearch(),h.Exo.hideShadow(),a("body").off("."+this.uniqueId),setTimeout(function(){t.$dropdownScroll.find(".hide").removeClass("hide"),h.Exo.unlockOverflow(t.$dropdown),!0===t.hasValue()?t.$element.addClass("filled"):t.$element.removeClass("filled"),!1===t.open&&(t.$element.removeClass("active"),t.$dropdown.removeClass("active").removeAttr("style"),t.$dropdownWrapper.removeAttr("class")),!0===t.isMobile&&t.$dropdown.removeAttr("style")},350),e&&setTimeout(function(){t.$hidden.trigger("focus",[1])}))}},{key:"htmlDecode",value:function(e){return a("<div/>").html(e).text().replace(/&amp;/g,"&")}},{key:"isRequired",value:function(){return void 0!==this.$field.attr("required")}},{key:"isDisabled",value:function(){return this.$field.is(":disabled")}},{key:"isSupported",value:function(){return!0===h.Exo.isIE()?8<=n.documentMode:!0!==this.isIos}}]),i}();h.behaviors.exoFormSelect={instances:{},once:!1,attach:function(e){a(e).find(".form-item.exo-form-select-js").once("exo.form.select").each(function(e,t){t=new i(a(t));h.behaviors.exoFormSelect.instances[t.uniqueId]=t}),!1===this.once&&(this.once,h.Exo.addOnResize("exo.form",function(){for(var e in h.behaviors.exoFormSelect.instances)h.behaviors.exoFormSelect.instances.hasOwnProperty(e)&&h.behaviors.exoFormSelect.instances[e].positionDropdown()}))},detach:function(e,t,i){if("unload"===i&&e!==n){var o,s,r=a(e).find(".form-item.exo-form-select-js");for(o in h.behaviors.exoFormSelect.instances)!h.behaviors.exoFormSelect.instances.hasOwnProperty(o)||(s=h.behaviors.exoFormSelect.instances[o]).$element.is(r)&&(s.destroy(),delete h.behaviors.exoFormSelect.instances[o])}}}}(jQuery,Drupal,document,Drupal.displace);