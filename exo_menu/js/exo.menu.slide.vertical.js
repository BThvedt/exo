"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _get(){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var a=_superPropBase(e,t);if(a)return a=Object.getOwnPropertyDescriptor(a,t),a.get?a.get.call(arguments.length<3?e:n):a.value}).apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(n){var a=_isNativeReflectConstruct();return function(){var e,t=_getPrototypeOf(n);return _possibleConstructorReturn(this,a?(e=_getPrototypeOf(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments))}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(c){var e=function(){_inherits(n,ExoMenuStyleBase);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),(e=t.call(this,e)).defaults={debug:!1,backNav:0,backText:"Back",backIcon:"",breadcrumbNav:1,backSelector:".exo-menu-top",breadcrumbText:"All",breadcrumbIcon:"",breadcrumbSeparatorIcon:"",breadcrumbSelector:".exo-menu-top",itemIcon:"",itemDelayInterval:60,direction:"r2l",theme:"",relocateNav:"",onItemClick:null},e.menuStorage={},e}return _createClass(n,[{key:"build",value:function(){_get(_getPrototypeOf(n.prototype),"build",this).call(this),this.buildCache(),this.$menus.length&&(this.buildElement(),this.bindEvents())}},{key:"refresh",value:function(){this.menuStorage[this.currentMenu]&&this.setWrapHeight(this.menuStorage[this.currentMenu].$menuEl)}},{key:"buildCache",value:function(){this.$menu=this.$element.find(".exo-menu-nav"),this.$wrap=this.$menu.find(".exo-menu-wrap"),this.$menus=this.$menu.find(".exo-menu-level"),this.get("breadcrumbNav")&&(this.$breadcrumbWrapper=this.$element.find(".exo-menu-top")),this.get("backNav")&&(this.$backWrapper=this.$element.find(".exo-menu-top"));var n="0-0";this.$menus.each(function(e,t){c(t).find(".exo-menu-link.is-active").length&&(n=c(t).data("menu"))}),this.currentMenu=n}},{key:"buildElement",value:function(){var e,t,r=this;this.$menus.each(function(e,t){var t=c(t),n=t.data("menu"),a=t.data("menu-parent"),a={$menuEl:t,$menuItems:t.find(".exo-menu-item"),backIdx:a,name:"0-0"===n?r.get("breadcrumbText"):r.$menus.find('.exo-menu-link[data-submenu="'+n+'"]').html()};r.menuStorage[n]=a,n===r.currentMenu&&(t.addClass("current"),r.setWrapHeight(t)),t.find(".exo-menu-link[data-submenu]").each(function(e,t){t=c(t);r.get("itemIcon")&&t.append(r.get("itemIcon"))})}),this.get("backNav")&&(t=this.fetchSelector(this.get("backSelector")))&&(t.find(".exo-menu-back").remove(),this.$backNav=c('<a class="exo-menu-back" aria-label="'+this.get("backText")+'" href="#"></a>').prependTo(t),e=this.get("backText"),this.get("backIcon")&&(e=this.get("backIcon")+" "+e),this.$backNav.html(e),"0-0"!==this.currentMenu&&this.$backNav.addClass("animate-fadeIn")),this.get("breadcrumbNav")&&(t=this.fetchSelector(this.get("breadcrumbSelector")))&&(t.find(".exo-menu-breadcrumbs").remove(),this.$breadcrumbNav=c('<nav class="exo-menu-breadcrumbs" aria-label="You are here"></nav>').prependTo(t),this.crawlCrumbs(this.menuStorage[this.currentMenu].backIdx,this.menuStorage),this.addBreadcrumb(this.currentMenu))}},{key:"bindEvents",value:function(){var e,i=this;for(e in this.menuStorage)this.menuStorage.hasOwnProperty(e)&&this.menuStorage[e].$menuItems.each(function(r,e){c(e).find(".exo-menu-link[data-submenu]").on("click",function(e){var t=c(e.currentTarget),n=t.html(),a=t.attr("data-submenu"),a=i.$menu.find('.exo-menu-level[data-menu="'+a+'"]');a.length?(e.preventDefault(),i.openSubMenu(a,r,n)):(i.$menu.find(".current").removeClass("current"),t.addClass("current"))})});this.get("backNav")&&this.$backNav.on("click",function(e){e.preventDefault(),i.back()})}},{key:"addBreadcrumb",value:function(n){var e,a,r=this;this.get("breadcrumbNav")&&((e=document.createElement("div")).innerHTML=this.menuStorage[n].name,e=e.innerText,a=c('<span class="exo-menu-breadcrumb">'),"0-0"===n&&this.get("breadcrumbIcon")?e=this.get("breadcrumbIcon")+e:this.get("breadcrumbSeparatorIcon")&&a.html('<span class="exo-menu-seperator">'+this.get("breadcrumbSeparatorIcon")+"</span>"),c('<a href="#"></a>').html(e).appendTo(a).on("click",function(e){if(e.preventDefault(),!a.next().length||r.isAnimating)return!1;r.isAnimating=!0,r.menuOut();var e=r.menuStorage[n].$menuEl,t=(r.menuIn(e),a.nextAll());t.one(Drupal.Exo.animationEvent,function(e){t.remove()}).addClass("animate-fadeOut")}),this.$breadcrumbNav.append(a),a.addClass("animate-fadeIn"))}},{key:"openSubMenu",value:function(e,t,n){if(this.isAnimating)return!1;var a=e.data("menu");this.isAnimating=!0,this.menuStorage[a].backIdx=this.currentMenu,this.menuStorage[a].name=n,this.menuOut(t),this.menuIn(e,t)}},{key:"back",value:function(){if(this.isAnimating)return!1;this.isAnimating=!0,this.menuOut();var e=this.menuStorage[this.menuStorage[this.currentMenu].backIdx].$menuEl;this.menuIn(e),this.get("breadcrumbNav")&&this.$breadcrumbNav.children().last().remove()}},{key:"menuIn",value:function(n,a){var r=this,i=this.menuStorage[this.currentMenu].$menuEl,u=void 0===a,o=n.data("menu"),e=this.menuStorage[o].$menuItems,s=e.length;this.setWrapHeight(n),u?"0-0"===o&&this.get("backNav")&&this.$backNav.removeClass("animate-fadeIn").addClass("animate-fadeOut"):(this.get("backNav")&&this.$backNav.removeClass("animate-fadeOut").addClass("animate-fadeIn"),this.addBreadcrumb(o)),e.each(function(e,t){t.style.webkitAnimationDelay=t.style.animationDelay=u?e*r.get("itemDelayInterval")+"ms":Math.abs(a-e)*r.get("itemDelayInterval")+"ms",e===(a<=s/2||u?s-1:0)&&c(t).one(Drupal.Exo.animationEvent,function(e){"r2l"===r.get("direction")?(i.removeClass(u?"animate-fadeOutRight":"animate-fadeOutLeft"),n.removeClass(u?"animate-fadeInLeft":"animate-fadeInRight")):(i.removeClass(u?"animate-fadeOutLeft":"animate-fadeOutRight"),n.removeClass(u?"animate-fadeInRight":"animate-fadeInLeft")),i.removeClass("current"),n.addClass("current"),r.currentMenu=o,r.isAnimating=!1,n.focus()})}),"r2l"===this.get("direction")?n.addClass(u?"animate-fadeInLeft":"animate-fadeInRight"):n.addClass(u?"animate-fadeInRight":"animate-fadeInLeft")}},{key:"menuOut",value:function(n){var a=this,e=this.menuStorage[this.currentMenu].$menuEl,r=void 0===n;this.menuStorage[this.currentMenu].$menuItems.each(function(e,t){t.style.webkitAnimationDelay=t.style.animationDelay=r?e*a.get("itemDelayInterval")+"ms":Math.abs(n-e)*a.get("itemDelayInterval")+"ms"}),"r2l"===this.get("direction")?e.addClass(r?"animate-fadeOutRight":"animate-fadeOutLeft"):e.addClass(r?"animate-fadeOutLeft":"animate-fadeOutRight")}},{key:"crawlCrumbs",value:function(e,t){0!==e&&("0-0"!==t[e].backIdx&&this.crawlCrumbs(t[e].backIdx,t),this.addBreadcrumb(e))}},{key:"setWrapHeight",value:function(t){var a=this;setTimeout(function(){t=t||a.$menus.filter(".current");var e=a.$wrap.height(),n=0;t.children().each(function(e,t){n+=c(t).outerHeight()}),e<=n?a.$wrap.height(n):t.one(Drupal.Exo.animationEvent,function(e){a.$wrap.height(n)})},10)}},{key:"fetchSelector",value:function(e){var t=this.$element.find(e);return(t=t.length?t:c(e).first()).length?t:null}},{key:"log",value:function(e){this.get("debug")&&("object"===_typeof(e)?console.log("[Exo Menu]",e):console.log("[Exo Menu] "+e))}}]),n}();Drupal.ExoMenuStyles.slide_vertical=e}(jQuery);